<?xml version="1.0" encoding="UTF-8" ?>
<Shell
    x:Class="GoatVaultClient.AppShell"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:local="clr-namespace:GoatVaultClient"
    xmlns:m="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
    xmlns:pages="clr-namespace:GoatVaultClient.Pages"
    xmlns:vm="clr-namespace:GoatVaultClient.ViewModels"
    Title="GoatVault"
    x:DataType="vm:AppShellViewModel"
    BackgroundColor="{AppThemeBinding Light={x:StaticResource LightSurface},
                                      Dark={x:StaticResource DarkSurface}}"
    FlyoutBehavior="Disabled"
    ForegroundColor="{AppThemeBinding Light={StaticResource LightOnPrimary},
                                      Dark={StaticResource DarkOnPrimary}}"
    TabBarBackgroundColor="{AppThemeBinding Light={x:StaticResource LightSurface},
                                            Dark={x:StaticResource DarkSurface}}"
    TabBarForegroundColor="{AppThemeBinding Light={x:StaticResource LightPrimary},
                                            Dark={x:StaticResource DarkPrimary}}"
    TabBarIsVisible="False"
    TabBarTitleColor="{AppThemeBinding Light={x:StaticResource LightOnSurface},
                                       Dark={x:StaticResource DarkOnSurface}}"
    TabBarUnselectedColor="{AppThemeBinding Light={x:StaticResource Gray500},
                                            Dark={x:StaticResource Gray400}}"
    TitleColor="{AppThemeBinding Light={x:StaticResource LightOnSurface},
                                 Dark={x:StaticResource DarkOnSurface}}">
    <Shell.TabBarIsVisible>
        <OnPlatform x:TypeArguments="x:Boolean">
            <On Platform="WinUI" Value="True" />
            <On Platform="Android, iOS, MacCatalyst" Value="False" />
        </OnPlatform>
    </Shell.TabBarIsVisible>
    <Shell.NavBarIsVisible>
        <OnPlatform x:TypeArguments="x:Boolean">
            <On Platform="WinUI" Value="False" />
            <On Platform="Android, iOS, MacCatalyst" Value="True" />
        </OnPlatform>
    </Shell.NavBarIsVisible>
    <!--
        NAVIGATION ARCHITECTURE (Flyout):
        ═══════════════════════════════════════════════════════════
        
        1. PRE-AUTH FLOW (FlyoutBehavior=Disabled):
        OnboardingPage → LoginPage ↔ RegisterPage
        
        2. POST-AUTH FLOW (FlyoutBehavior=Flyout):
        Hamburger menu with: Vault | Security
        FlyoutBehavior toggled in AppShell.xaml.cs after login/logout
        
        Navigation stack is cleared on:
        - Login/Register → Main  (//main/home)  + enable flyout
        - Logout from SecurityPage   (//intro)       + disable flyout
        ═══════════════════════════════════════════════════════════
    -->

    <!--  ============================================================  -->
    <!--  FLYOUT HEADER  -->
    <!--  ============================================================  -->
    <Shell.FlyoutHeader>
        <Grid
            Padding="20"
            BackgroundColor="{AppThemeBinding Light={StaticResource LightPrimary},
                                              Dark={StaticResource DarkPrimary}}"
            HeightRequest="60">
            <VerticalStackLayout Spacing="8" VerticalOptions="Center">
                <Label
                    FontAttributes="Bold"
                    FontSize="20"
                    Text="GoatVault"
                    TextColor="{AppThemeBinding Light={StaticResource LightOnPrimary},
                                                Dark={StaticResource DarkOnPrimary}}" />
            </VerticalStackLayout>
        </Grid>
    </Shell.FlyoutHeader>

    <!--  ============================================================  -->
    <!--  PRE-AUTH: Hidden from flyout menu  -->
    <!--  ============================================================  -->

    <ShellContent
        ContentTemplate="{DataTemplate pages:OnboardingPage}"
        FlyoutItemIsVisible="False"
        Route="intro"
        Shell.NavBarIsVisible="False" />
    <ShellContent
        ContentTemplate="{DataTemplate pages:LoginPage}"
        FlyoutItemIsVisible="False"
        Route="login"
        Shell.NavBarIsVisible="False" />
    <ShellContent
        ContentTemplate="{DataTemplate pages:RegisterPage}"
        FlyoutItemIsVisible="False"
        Route="register"
        Shell.NavBarIsVisible="False" />
    <ShellContent
        ContentTemplate="{DataTemplate pages:GratitudePage}"
        FlyoutItemIsVisible="False"
        Route="gratitude"
        Shell.NavBarIsVisible="False" />

    <!--  ============================================================  -->
    <!--  POST-AUTH: Flyout menu items  -->
    <!--  ============================================================  -->
    <FlyoutItem FlyoutDisplayOptions="AsMultipleItems" Route="main">
        <ShellContent
            Title="Vault"
            ContentTemplate="{DataTemplate local:MainPage}"
            Icon="{FontImageSource FontFamily=MaterialSharp,
                                   Glyph={x:Static m:MaterialRounded.Lock},
                                   Color={AppThemeBinding Light={StaticResource LightOnSurface},
                                                          Dark={StaticResource DarkOnSurface}}}"
            Route="home" />

        <ShellContent
            Title="Security"
            ContentTemplate="{DataTemplate pages:SecurityPage}"
            Icon="{FontImageSource FontFamily=MaterialSharp,
                                   Glyph={x:Static m:MaterialRounded.Security},
                                   Color={AppThemeBinding Light={StaticResource LightOnSurface},
                                                          Dark={StaticResource DarkOnSurface}}}"
            Route="security" />

        <ShellContent
            Title="Settings"
            ContentTemplate="{DataTemplate pages:SettingsPage}"
            Icon="{FontImageSource FontFamily=MaterialSharp,
                                   Glyph={x:Static m:MaterialRounded.Settings},
                                   Color={AppThemeBinding Light={StaticResource LightOnSurface},
                                                          Dark={StaticResource DarkOnSurface}}}"
            Route="settings" />
    </FlyoutItem>

    <TabBar>
        <ShellContent
            Title="Vault"
            ContentTemplate="{DataTemplate local:MainPage}"
            Icon="{FontImageSource FontFamily=MaterialSharp,
                                   Glyph={x:Static m:MaterialRounded.Lock},
                                   Color={AppThemeBinding Light={StaticResource LightOnSurface},
                                                          Dark={StaticResource DarkOnSurface}}}"
            Route="home"
            Shell.NavBarIsVisible="False" />

        <ShellContent
            Title="Security"
            ContentTemplate="{DataTemplate pages:SecurityPage}"
            Icon="{FontImageSource FontFamily=MaterialSharp,
                                   Glyph={x:Static m:MaterialRounded.Security},
                                   Color={AppThemeBinding Light={StaticResource LightOnSurface},
                                                          Dark={StaticResource DarkOnSurface}}}"
            Route="security" />

        <ShellContent
            Title="Settings"
            ContentTemplate="{DataTemplate pages:SettingsPage}"
            Icon="{FontImageSource FontFamily=MaterialSharp,
                                   Glyph={x:Static m:MaterialRounded.Settings},
                                   Color={AppThemeBinding Light={StaticResource LightOnSurface},
                                                          Dark={StaticResource DarkOnSurface}}}"
            Route="settings" />
    </TabBar>

    <!--  ============================================================  -->
    <!--  FLYOUT FOOTER  -->
    <!--  ============================================================  -->
    <Shell.FlyoutFooter>
        <Grid Padding="20" HeightRequest="60">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <Label
                FontSize="12"
                Text="© 2026 GoatVault"
                TextColor="{AppThemeBinding Light={StaticResource Gray500},
                                            Dark={StaticResource Gray400}}"
                VerticalOptions="Center" />

            <!--  Logout button with icon and text  -->
            <HorizontalStackLayout
                Grid.Column="1"
                Spacing="5"
                VerticalOptions="Center">

                <Label
                    FontFamily="MaterialSharp"
                    FontSize="20"
                    Text="Logout"
                    TextColor="{AppThemeBinding Light={StaticResource LightOnSurface},
                                                Dark={StaticResource DarkOnSurface}}" />

                <Label
                    FontSize="14"
                    Text="Logout"
                    TextColor="{AppThemeBinding Light={StaticResource LightOnSurface},
                                                Dark={StaticResource DarkOnSurface}}"
                    VerticalOptions="Center" />

                <HorizontalStackLayout.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding LogoutCommand}" />
                </HorizontalStackLayout.GestureRecognizers>
            </HorizontalStackLayout>
        </Grid>
    </Shell.FlyoutFooter>

    <!--<FlyoutItem Title="Introduction" Icon="{FontImageSource FontFamily=MaterialSharp, Glyph={x:Static m:MaterialRounded.Handshake}}">
        <ShellContent ContentTemplate="{DataTemplate pages:OnboardingPage}" Route="OnboardingPage" Icon="{FontImageSource FontFamily=MaterialSharp, Glyph={x:Static m:MaterialRounded.Key}}" />
    </FlyoutItem>
    <FlyoutItem Title="Vault" Icon="{FontImageSource FontFamily=MaterialSharp, Glyph={x:Static m:MaterialRounded.Home}}">
        <ShellContent Title="Vault" ContentTemplate="{DataTemplate local:MainPage}" Route="MainPage" Icon="user_icon.png" />
    </FlyoutItem>
    </FlyoutItem>
    <FlyoutItem Title="User" Icon="{FontImageSource FontFamily=MaterialSharp, Glyph={x:Static m:MaterialRounded.Account_circle}}">
        <ShellContent Title="UserSettings" ContentTemplate="{DataTemplate pages:SecurityPage}" Route="SecurityPage" />
    </FlyoutItem>-->
</Shell>
