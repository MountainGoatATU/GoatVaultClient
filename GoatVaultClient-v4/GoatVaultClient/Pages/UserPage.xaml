<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
             xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
             xmlns:vm="clr-namespace:GoatVaultClient.ViewModels"
             xmlns:controls="clr-namespace:GoatVaultClient.Controls"
             xmlns:m="clr-namespace:UraniumUI.Icons.MaterialSymbols;assembly=UraniumUI.Icons.MaterialSymbols"
             xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.Maui;assembly=LiveChartsCore.SkiaSharpView.Maui"
             x:Class="GoatVaultClient.Pages.UserPage"
             x:DataType="vm:UserPageViewModel"
             BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}">

    <ScrollView>
        <VerticalStackLayout Spacing="{StaticResource sLarge}" Padding="{StaticResource pLarge}">

            <!-- Vault Score Section -->
            <controls:Component>
                <VerticalStackLayout Spacing="10" HorizontalOptions="Center">
                    <Label Text="Vault Score" FontAttributes="Bold" FontSize="24" HorizontalOptions="Center"/>
                    <lvc:PieChart InitialRotation="-90" MinValue="0" MaxValue="1000" HeightRequest="150" WidthRequest="150">
                        <lvc:PieChart.Series>
                            <lvc:SeriesCollection>
                                <!-- Should be bind to real value -->
                                <lvc:XamlGaugeSeries GaugeValue="560" DataLabelsSize="20" MaxRadialColumnWidth="50"/>
                                <lvc:XamlGaugeBackgroundSeries MaxRadialColumnWidth="50" Fill="LightGray"/>
                            </lvc:SeriesCollection>
                        </lvc:PieChart.Series>
                    </lvc:PieChart>
                </VerticalStackLayout>
            </controls:Component>

            <!-- Account Settings Section -->
            <controls:ComponentHeader Title="Account Settings"/>
            <controls:Component>
                <VerticalStackLayout Spacing="20" Padding="20">

                    <!-- Email -->
                    <Grid ColumnDefinitions="150,*,Auto" ColumnSpacing="10">
                        <Label Text="Email" 
                               FontAttributes="Bold" 
                               VerticalOptions="Center"/>
                        <Label Grid.Column="1" 
                               Text="{Binding Email}" 
                               VerticalOptions="Center"
                               FontSize="14"/>
                        <controls:ImageButton Grid.Column="2" 
                                              IconGlyph="{x:Static m:MaterialRounded.Edit}" 
                                              Command="{Binding EditEmailCommand}"/>
                    </Grid>

                    <!-- Master Password -->
                    <Grid ColumnDefinitions="150,*,Auto" ColumnSpacing="10">
                        <Label Text="Master Password" 
                               FontAttributes="Bold" 
                               VerticalOptions="Center"/>
                        <Label Grid.Column="1" 
                               Text="••••••••••••" 
                               VerticalOptions="Center"
                               FontSize="14"/>
                        <controls:ImageButton Grid.Column="2" 
                                              IconGlyph="{x:Static m:MaterialRounded.Edit}" 
                                              Command="{Binding EditMasterPasswordCommand}"/>
                    </Grid>

                </VerticalStackLayout>
            </controls:Component>

            <!-- Two-Factor Authentication Section -->
            <controls:ComponentHeader Title="Two-Factor Authentication"/>
            <controls:Component>
                <VerticalStackLayout Spacing="15" Padding="20">
                    <!-- MFA Status -->
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                        <Label Text="Status" 
                               FontSize="14"
                               FontAttributes="Bold"
                               VerticalOptions="Center"/>
                        <HorizontalStackLayout Grid.Column="1" Spacing="8">
                            <Border BackgroundColor="{Binding MfaEnabled, Converter={StaticResource BoolToColorConverter}}"
                                    WidthRequest="12"
                                    HeightRequest="12"
                                    StrokeShape="RoundRectangle 6"
                                    VerticalOptions="Center"/>
                            <Label Text="{Binding MfaEnabled, Converter={StaticResource BoolToMfaStatusConverter}}"
                                   FontSize="14"
                                   VerticalOptions="Center"/>
                        </HorizontalStackLayout>
                    </Grid>

                    <!-- MFA Description -->
                    <Label Text="Two-factor authentication adds an extra layer of security to your account by requiring a time-based code from your authenticator app in addition to your password."
                           FontSize="12"
                           TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"
                           LineBreakMode="WordWrap"/>

                    <!-- Enable/Disable Button -->
                    <Button Text="{Binding MfaEnabled, Converter={StaticResource BoolToMfaButtonTextConverter}}"
                            Command="{Binding EnableMfaCommand}"
                            IsVisible="{Binding MfaEnabled, Converter={StaticResource InvertedBoolConverter}}"
                            BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                            TextColor="White"
                            Margin="0,10,0,0"/>

                    <Button Text="Disable MFA"
                            Command="{Binding DisableMfaCommand}"
                            IsVisible="{Binding MfaEnabled}"
                            BackgroundColor="{AppThemeBinding Light={StaticResource Error}, Dark={StaticResource ErrorDark}}"
                            TextColor="White"
                            Margin="0,10,0,0"/>

                </VerticalStackLayout>
            </controls:Component>

            <!-- Logout Section -->
            <controls:Component>
                <VerticalStackLayout Padding="20">
                    <Button Text="Logout"
                            Command="{Binding LogoutCommand}"
                            BackgroundColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"
                            TextColor="White"/>
                </VerticalStackLayout>
            </controls:Component>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
