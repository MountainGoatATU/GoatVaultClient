<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:GoatVaultClient.Controls"
             xmlns:m="clr-namespace:UraniumUI.Icons.MaterialSymbols;assembly=UraniumUI.Icons.MaterialSymbols"
             xmlns:vm="clr-namespace:GoatVaultClient.ViewModels"
             x:Class="GoatVaultClient.Controls.EntryDetailView">

    <ContentView.Resources>
        <ResourceDictionary>
            <vm:EyeIconConverter x:Key="EyeIconConverter"/>
        </ResourceDictionary>
    </ContentView.Resources>

    <controls:Component BorderMargin="0">
        <VerticalStackLayout Spacing="10">

            <controls:ComponentHeader Title="{Binding Site, TargetNullValue='Select an Entry'}">
                <controls:ComponentHeader.Actions>
                    <HorizontalStackLayout Spacing="{x:StaticResource sContent}">
                        <controls:ImageButton IconGlyph="{x:Static m:MaterialRounded.Edit}"
                                              Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainPageViewModel}}, Path=EditEntryCommand}"/>

                        <controls:ImageButton IconGlyph="{x:Static m:MaterialRounded.Delete}"
                                              Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainPageViewModel}}, Path=DeleteEntryCommand}"/>
                    </HorizontalStackLayout>
                </controls:ComponentHeader.Actions>
            </controls:ComponentHeader>

            <VerticalStackLayout Spacing="15" Margin="15">

                <!-- Username -->
                <VerticalStackLayout>
                    <Label Text="USERNAME" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"/>
                    <Label Text="{Binding UserName}" FontSize="16" FontAttributes="Bold"/>
                </VerticalStackLayout>

                <!-- Password -->
                <VerticalStackLayout>
                    <Label Text="PASSWORD" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"/>
                    <Grid ColumnDefinitions="*, Auto, Auto">
                        <Label Grid.Column="0" 
                               Text="{Binding Password}" 
                               FontSize="16" 
                               FontAttributes="Bold"
                               VerticalOptions="Center">
                            <Label.Triggers>
                                <DataTrigger TargetType="Label" 
                                             Binding="{Binding Source={RelativeSource AncestorType={x:Type vm:MainPageViewModel}}, Path=IsPasswordVisible}" 
                                             Value="False">
                                    <Setter Property="Text" Value="••••••••"/>
                                </DataTrigger>
                            </Label.Triggers>
                        </Label>

                        <controls:ImageButton Grid.Column="1"
                                              IconGlyph="{Binding Source={RelativeSource AncestorType={x:Type vm:MainPageViewModel}}, Path=IsPasswordVisible, Converter={StaticResource EyeIconConverter}}"
                                              Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainPageViewModel}}, Path=TogglePasswordVisibilityCommand}"/>
                        <controls:ImageButton Grid.Column="2"
                                              IconGlyph="{x:Static m:MaterialRounded.Content_copy}"
                                              Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainPageViewModel}}, Path=CopyEntryCommand}"/>
                    </Grid>
                </VerticalStackLayout>

                <!-- MFA -->
                <VerticalStackLayout IsVisible="{Binding HasMfa}">
                    <Label Text="MFA CODE (TOTP)" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"/>
                    <Grid ColumnDefinitions="Auto, *, Auto, Auto" ColumnSpacing="10">
                        <Label Grid.Column="0"
                               Text="{Binding CurrentTotpCode, TargetNullValue='------'}" 
                               FontSize="24" 
                               FontFamily="JetBrainsMonoRegular"
                               FontAttributes="Bold"
                               VerticalOptions="Center"
                               TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"/>

                        <ProgressBar Grid.Column="1"
                                     Progress="{Binding TotpTimeRemaining, Converter={StaticResource TimeToProgressConverter}}"
                                     HeightRequest="6"
                                     VerticalOptions="Center"
                                     ProgressColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"/>

                        <Label Grid.Column="2"
                               Text="{Binding TotpTimeRemaining, StringFormat='{0}s'}"
                               FontSize="14"
                               VerticalOptions="Center"
                               TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"/>

                        <controls:ImageButton Grid.Column="3"
                                              IconGlyph="{x:Static m:MaterialRounded.Content_copy}"
                                              ToolTipProperties.Text="Copy TOTP Code"
                                              Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainPageViewModel}}, Path=CopyTotpCodeCommand}"/>
                    </Grid>
                </VerticalStackLayout>

                <!-- Category -->
                <VerticalStackLayout>
                    <Label Text="CATEGORY" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"/>
                    <Label Text="{Binding Category}" FontSize="16"/>
                </VerticalStackLayout>

                <!-- Description -->
                <VerticalStackLayout>
                    <Label Text="DESCRIPTION" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"/>
                    <Label Text="{Binding Description}" FontSize="14"/>
                </VerticalStackLayout>

            </VerticalStackLayout>
        </VerticalStackLayout>
    </controls:Component>
</ContentView>